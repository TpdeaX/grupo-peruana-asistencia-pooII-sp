:root {
    /* --- MD3 Color Tokens (Light) --- */
    --md-sys-color-primary: #6750A4;
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-primary-container: #EADDFF;
    --md-sys-color-on-primary-container: #21005D;

    --md-sys-color-secondary: #625B71;
    --md-sys-color-on-secondary: #FFFFFF;
    --md-sys-color-secondary-container: #E8DEF8;
    --md-sys-color-on-secondary-container: #1D192B;

    --md-sys-color-tertiary: #7D5260;
    --md-sys-color-on-tertiary: #FFFFFF;
    --md-sys-color-tertiary-container: #FFD8E4;
    --md-sys-color-on-tertiary-container: #31111D;

    --md-sys-color-error: #B3261E;
    --md-sys-color-on-error: #FFFFFF;
    --md-sys-color-error-container: #F9DEDC;
    --md-sys-color-on-error-container: #410E0B;
    
    --md-sys-color-success: #2e7d32;
    --md-sys-color-on-success: #FFFFFF;
    --md-sys-color-success-container: #e8f5e9;
    --md-sys-color-on-success-container: #0c3b10;

    --md-sys-color-background: #F8F9FA; 
    --md-sys-color-on-background: #1C1B1F;

    --md-sys-color-surface: #FFFFFF; 
    --md-sys-color-on-surface: #1C1B1F;
    --md-sys-color-surface-variant: #E7E0EC;
    --md-sys-color-on-surface-variant: #49454F;

    /* Surface Containers (Added for M3 Components) */
    --md-sys-color-surface-container-lowest: #FFFFFF;
    --md-sys-color-surface-container-low: #F7F2FA;
    --md-sys-color-surface-container: #F3EDF7;
    --md-sys-color-surface-container-high: #ECE6F0;
    --md-sys-color-surface-container-highest: #E6E0E9;

    --md-sys-color-outline: #79747E;
    --md-sys-color-outline-variant: #C4C7C5;

    --md-sys-overlay: rgba(0,0,0,0.5);

    /* --- Elevations --- */
    --md-sys-elevation-0: 0px 0px 0px 0px rgba(0, 0, 0, 0);
    --md-sys-elevation-1: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    --md-sys-elevation-2: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
    --md-sys-elevation-3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px 0px rgba(0, 0, 0, 0.3);

    /* --- Legacy Mappings --- */
    --bg-header: var(--md-sys-color-surface);
    --bg-sidebar: var(--md-sys-color-surface); /* Added for sidebar */
    --bg-surface: var(--md-sys-color-surface);
    --bg-surface-container: var(--md-sys-color-surface-container-low);
    --bg-body: var(--md-sys-color-background);
    
    --border-color: var(--md-sys-color-outline-variant);
    --text-primary: var(--md-sys-color-on-surface);
    --text-secondary: var(--md-sys-color-on-surface-variant);
    --icon-color: var(--md-sys-color-on-surface-variant);
    --bg-hover: var(--md-sys-color-surface-container-highest);

    /* --- Animation --- */
    --md-sys-motion-duration-short: 200ms;
    --md-sys-motion-duration-medium: 400ms;
    --md-sys-motion-easing-standard: cubic-bezier(0.2, 0.0, 0, 1.0);
}

[data-theme="dark"] {
    /* --- MD3 Color Tokens (Dark) --- */
    --md-sys-color-primary: #D0BCFF;
    --md-sys-color-on-primary: #381E72;
    --md-sys-color-primary-container: #4F378B;
    --md-sys-color-on-primary-container: #EADDFF;

    --md-sys-color-secondary: #CCC2DC;
    --md-sys-color-on-secondary: #332D41;
    --md-sys-color-secondary-container: #4A4458;
    --md-sys-color-on-secondary-container: #E8DEF8;

    --md-sys-color-tertiary: #EFB8C8;
    --md-sys-color-on-tertiary: #492532;
    --md-sys-color-tertiary-container: #633B48;
    --md-sys-color-on-tertiary: #FFD8E4;

    --md-sys-color-error: #F2B8B5;
    --md-sys-color-on-error: #601410;
    --md-sys-color-error-container: #8C1D18;
    --md-sys-color-on-error-container: #F9DEDC;
    
    --md-sys-color-success: #81c784;
    --md-sys-color-on-success: #003300;
    --md-sys-color-success-container: #1b5e20;
    --md-sys-color-on-success-container: #e8f5e9;

    --md-sys-color-background: #141218; /* Darker standard background */
    --md-sys-color-on-background: #E6E1E5;

    --md-sys-color-surface: #141218; 
    --md-sys-color-on-surface: #E6E1E5;
    --md-sys-color-surface-variant: #49454F;
    --md-sys-color-on-surface-variant: #CAC4D0;

    /* Surface Containers (Dark) */
    --md-sys-color-surface-container-lowest: #0F0D13;
    --md-sys-color-surface-container-low: #1D1B20;
    --md-sys-color-surface-container: #211F26;
    --md-sys-color-surface-container-high: #2B2930;
    --md-sys-color-surface-container-highest: #36343B;

    --md-sys-color-outline: #938F99;
    --md-sys-color-outline-variant: #49454F; 

    --md-sys-overlay: rgba(255,255,255,0.1);

    /* Update Legacy Mappings for Dark Mode */
    --bg-header: #1E1E1E; /* Use a slightly elevated surface for header */
    --bg-sidebar: var(--md-sys-color-surface); /* Dark mode sidebar */
    --bg-surface: var(--md-sys-color-surface);
    --bg-surface-container: var(--md-sys-color-surface-container-low);
    --bg-body: var(--md-sys-color-background);
    
    --bg-hover: var(--md-sys-color-surface-container-highest);
}

/* Base resets */
* { box-sizing: border-box; }

body {
    font-family: 'Roboto', sans-serif;
    background-color: var(--md-sys-color-background);
    color: var(--md-sys-color-on-background);
    margin: 0;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
}

/* Only animate theme changes when manually triggered */
body.theme-transition,
body.theme-transition * {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease !important;
}

/* --- Layout Utilities --- */
.container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 24px;
    animation: fadeIn var(--md-sys-motion-duration-medium) var(--md-sys-motion-easing-standard);
}

.d-flex { display: flex; }
.align-center { align-items: center; }
.justify-between { justify-content: space-between; }
.justify-end { justify-content: flex-end; }
.gap-2 { gap: 8px; }
.gap-3 { gap: 16px; }

/* --- Typography --- */
h1, h2, h3 { 
    margin: 0; 
    font-weight: 400; 
    color: var(--md-sys-color-on-surface); 
}
h1 { font-size: 2.5rem; line-height: 3rem; }
h2 { font-size: 2rem; line-height: 2.5rem; }
h3 { font-size: 1.5rem; line-height: 2rem; }

/* --- Components: Card --- */
.card {
    background-color: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    border-radius: 16px;
    box-shadow: var(--md-sys-elevation-1);
    border: 1px solid var(--md-sys-color-outline-variant); /* Border for definition */
    overflow: hidden;
    transition: box-shadow var(--md-sys-motion-duration-short);
}
.card:hover {
    box-shadow: var(--md-sys-elevation-2);
}
.card-body { padding: 24px; }
.card-header { 
    padding: 24px; 
    border-bottom: 1px solid var(--md-sys-color-outline-variant);
    background-color: var(--md-sys-color-surface); /* Keep it same as card but rely on border */
    font-weight: 500;
}

/* --- Components: Buttons --- */
.btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 0 24px;
    height: 40px;
    border-radius: 20px;
    font-family: 'Roboto', sans-serif;
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.1px;
    border: none;
    cursor: pointer;
    overflow: hidden;
    transition: all var(--md-sys-motion-duration-short);
    text-decoration: none;
}

.btn-icon {
    width: 40px;
    padding: 0;
    border-radius: 50%;
    color: var(--md-sys-color-on-surface-variant);
    background: transparent;
}
.btn-icon:hover {
    background-color: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
}

.btn-primary {
    background-color: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    box-shadow: var(--md-sys-elevation-1);
}
.btn-primary:hover {
    box-shadow: var(--md-sys-elevation-2);
    filter: brightness(0.9);
}

.btn-secondary {
    background-color: transparent;
    color: var(--md-sys-color-primary);
    border: 1px solid var(--md-sys-color-outline);
}
.btn-secondary:hover {
    background-color: var(--md-sys-color-secondary-container);
    color: var(--md-sys-color-on-secondary-container);
    border-color: transparent;
}

.btn-danger {
    background-color: var(--md-sys-color-error);
    color: var(--md-sys-color-on-error);
}

.btn-success {
    background-color: var(--md-sys-color-success);
    color: var(--md-sys-color-on-success);
}

/* --- Components: Table --- */
.table-container {
    width: 100%;
    overflow-x: auto;
    border-radius: 16px; 
    background: var(--md-sys-color-surface);
}

table {
    width: 100%;
    border-collapse: collapse; /* Ensure borders collapse for clean lines */
    white-space: nowrap;
}

thead th {
    text-align: left;
    padding: 16px 24px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface-variant);
    border-bottom: 2px solid var(--md-sys-color-outline-variant); /* Thicker header border */
    background-color: var(--md-sys-color-surface);
}

tbody td {
    padding: 16px 24px;
    border-bottom: 1px solid var(--md-sys-color-outline-variant); /* Visible rows */
    color: var(--md-sys-color-on-surface);
}

tbody tr {
    transition: background-color var(--md-sys-motion-duration-short);
}
tbody tr:hover {
    background-color: var(--md-sys-color-surface-variant); 
    /* In dark mode this might be too light, handled by opacity usually but solid color is safer */
}
[data-theme="dark"] tbody tr:hover {
    background-color: rgba(255,255,255, 0.05);
}

/* Table Animation: Staggered Fade In */
tbody tr {
    animation: slideInUp 0.5s ease backwards;
}
tbody tr:nth-child(1) { animation-delay: 0.05s; }
tbody tr:nth-child(2) { animation-delay: 0.1s; }
tbody tr:nth-child(3) { animation-delay: 0.15s; }
tbody tr:nth-child(4) { animation-delay: 0.2s; }
tbody tr:nth-child(5) { animation-delay: 0.25s; }

/* --- Components: Inputs (Floating Label) --- */
.md-input-group {
    position: relative;
    margin-bottom: 24px;
}

.md-input {
    width: 100%;
    padding: 12px 16px;
    font-size: 1rem;
    color: var(--md-sys-color-on-surface);
    border: 1px solid var(--md-sys-color-outline);
    border-radius: 4px;
    background: var(--md-sys-color-surface);
    transition: border-color 0.2s, background-color 0.2s;
    outline: none;
    height: 56px;
    border-radius: 4px 4px 0 0;
    background-color: var(--md-sys-color-surface-variant); 
    border-bottom: 1px solid var(--md-sys-color-outline);
    border-top: none; border-left: none; border-right: none;
    padding-top: 24px;
}
/* Dark mode input adjustment */
[data-theme="dark"] .md-input {
    background-color: rgba(231, 224, 236, 0.05); /* Very subtle fill */
}

.md-input:focus {
    border-bottom: 2px solid var(--md-sys-color-primary);
    background-color: var(--md-sys-color-surface-variant);
    filter: brightness(1.05); 
}

.md-label {
    position: absolute;
    left: 16px;
    top: 16px;
    color: var(--md-sys-color-on-surface-variant);
    pointer-events: none;
    transition: 0.2s ease all;
}

.md-input:focus ~ .md-label,
.md-input:not(:placeholder-shown) ~ .md-label,
.md-input:valid ~ .md-label {
    top: 6px;
    font-size: 0.75rem;
    color: var(--md-sys-color-primary);
}

/* --- Components: Chips/Badges --- */
.chip {
    display: inline-flex;
    align-items: center;
    padding: 6px 16px;
    border-radius: 16px; 
    font-size: 0.875rem;
    font-weight: 500;
}
.chip-success { background: var(--md-sys-color-success-container); color: var(--md-sys-color-on-success-container); }
.chip-warning { background: #fff8e1; color: #f57c00; border: 1px solid #ffe082; }
.chip-error   { background: var(--md-sys-color-error-container); color: var(--md-sys-color-on-error-container); }
.chip-info    { background: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); }
/* Dark mode chips */
[data-theme="dark"] .chip-warning { background: #5c4200; color: #ffca28; border: 1px solid #6f5500; }


/* --- Animations --- */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes slideInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- Modal --- */
/* --- Material Web Components Overrides --- */
:root {
    /* Dialog */
    --md-dialog-container-color: var(--md-sys-color-surface);
    --md-dialog-headline-color: var(--md-sys-color-on-surface);
    --md-dialog-supporting-text-color: var(--md-sys-color-on-surface-variant);
    --md-dialog-scrim-color: rgba(0,0,0,0.3); /* Lighter base, blurs will handle the rest */
    --md-dialog-container-shape: 28px;
    
    /* Text Fields */
    --md-outlined-text-field-container-color: var(--md-sys-color-surface);
    --md-outlined-text-field-input-text-color: var(--md-sys-color-on-surface);
    --md-outlined-text-field-label-text-color: var(--md-sys-color-on-surface-variant);
    --md-outlined-text-field-outline-color: var(--md-sys-color-outline);
    --md-outlined-text-field-focus-outline-color: var(--md-sys-color-primary);
    --md-outlined-text-field-focus-label-text-color: var(--md-sys-color-primary);
    --md-outlined-text-field-caret-color: var(--md-sys-color-primary);

    /* Select */
    --md-outlined-select-text-field-container-color: var(--md-sys-color-surface);
    --md-outlined-select-text-field-input-text-color: var(--md-sys-color-on-surface);
    --md-outlined-select-text-field-label-text-color: var(--md-sys-color-on-surface-variant);
    --md-outlined-select-text-field-outline-color: var(--md-sys-color-outline);
    --md-outlined-select-text-field-focus-outline-color: var(--md-sys-color-primary);
    --md-outlined-select-text-field-focus-label-text-color: var(--md-sys-color-primary);
    
    /* Buttons in Dialog */
    --md-text-button-label-text-color: var(--md-sys-color-primary);
    --md-text-button-hover-label-text-color: var(--md-sys-color-primary);
    --md-filled-button-container-color: var(--md-sys-color-primary);
    --md-filled-button-label-text-color: var(--md-sys-color-on-primary);
}

/* Specific Dark Mode Overrides for Web Components */
[data-theme="dark"] {
    /* Ensure Inputs are distinct in dark mode */
    --md-outlined-text-field-container-color: rgba(0,0,0,0.2); 
    --md-outlined-select-text-field-container-color: rgba(0,0,0,0.2);
    
    /* Dialog Elevation & Border */
    --md-dialog-container-color: #2B2930;
    --md-dialog-scrim-color: rgba(0,0,0,0.5);
    
    /* Input Outlines - lighter for visibility */
    --md-outlined-text-field-outline-color: #938F99;
    --md-outlined-select-text-field-outline-color: #938F99;
}

/* --- MD Dialog Scrim Fix --- */
/* Fix Z-Index Stacking: Sidebar vs Modal */
/* Sidebar z-index handled in sidebar.jsp (1200) which is < md-dialog (9999) */


/* Native dialog override for overflow */
md-dialog {
    max-width: 440px;
    width: 100%;
    z-index: 9999 !important;
    position: fixed;
    inset: 0;
    margin: auto;
    overflow: visible !important; /* --- Dialog Decoration --- */
    --md-dialog-container-shape: 28px;
    --md-dialog-container-color: var(--md-sys-color-surface);
    /* Subtle gradient for the header area */
    background: linear-gradient(to bottom, var(--md-sys-color-surface-container-high) 0%, var(--md-sys-color-surface) 120px) !important; 
    /* Entrance Animation */
    animation: dialog-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    
    /* FIX: Ensure space for top icon */
    margin-top: 80px !important;
}

/* FIX: Attempting to style the standard dialog backdrop if exposed, or fallback */
md-dialog::backdrop {
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(8px);
}

@keyframes dialog-pop {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* --- Floating Hero Icon with COLOR GLOW --- */
md-dialog > md-icon[slot="icon"] {
    font-size: 48px;
    width: 64px;
    height: 64px;
    /* Absolutely position to break out of flow reliably */
    position: absolute;
    top: -32px; /* FIX: Less negative to avoid screen edge clipping if margins are tight */
    left: 50%;
    transform: translateX(-50%);
    
    background: linear-gradient(135deg, var(--md-sys-color-primary-container), var(--md-sys-color-surface));
    color: var(--md-sys-color-primary);
    border-radius: 50%;
    display: grid;
    place-items: center;
    /* Colored Glow Shadow */
    box-shadow: 0 10px 25px -5px rgba(103, 80, 164, 0.4); 
    z-index: 2; /* On top of dialog */
}

/* Dark mode glow adjustment */
[data-theme="dark"] md-dialog > md-icon[slot="icon"] {
    box-shadow: 0 10px 25px -5px rgba(208, 188, 255, 0.3);
}

/* --- Headline & Header Decoration --- */
[slot="headline"] {
    margin-top: 24px; /* Reduced since icon is higher */
    text-align: center;
    font-size: 1.5rem;
    font-weight: 500;
    color: var(--md-sys-color-on-surface);
    position: relative;
    padding-bottom: 12px; 
}

/* Tapered decorative underline - REMOVED per user request */
/* [slot="headline"]::after { ... } */

/* --- Content Area Layout --- */
form[slot="content"] {
    padding-top: 4px; /* Ultra tight */
}

.dialog-content {
    display: flex;
    flex-direction: column;
    gap: 16px; /* Tightened gap */
    width: 100%;
    box-sizing: border-box;
    padding-bottom: 4px; /* Space before actions */
}

/* Full width inputs */
.full-width-field {
    width: 100%;
}

.row-inputs {
    display: flex;
    gap: 12px;
    justify-content: space-between;
}

.row-inputs > * {
    flex: 1; 
}

/* Ensure material web components take full width */
md-outlined-text-field, md-outlined-select {
    width: 100%;
}

/* --- Actions Footer --- */
div[slot="actions"] {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding-top: 12px; /* Breathing room from inputs */
    padding-bottom: 8px;
}

@media (max-width: 600px) {
    /* Full screen dialog on mobile */
    md-dialog {
        max-width: 100%;
        max-height: 100%;
        height: 100%;
        width: 100%;
        margin: 0;
        border-radius: 0;
        --md-dialog-container-shape: 0px;
    }
    
    md-dialog > md-icon[slot="icon"] {
        position: relative;
        top: 0;
        left: auto;
        transform: none;
        margin: 24px auto 16px;
    }

    [slot="headline"] {
        margin-top: 0;
    }
}
    



/* --- Toast Styles --- */
/* Container just holds DOM nodes, no layout */
.toast-container {
    display: none; 
}

.toast {
    /* Fixed positioning for individual popovers - Force Override with !important */
    position: fixed !important;
    inset: auto !important; /* Reset all text-align/centering from Popover UA */
    top: auto !important;
    left: auto !important;
    right: 24px !important;
    bottom: 24px !important; /* JS will override this inline, but initial needs to be correct */
    margin: 0 !important;
    padding: 16px 20px;
    
    /* Visuals */
    display: flex;
    align-items: center;
    gap: 16px;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
    border: none;
    min-width: 320px;
    max-width: 400px;
    
    /* Initial State */
    transform: translateX(120%);
    opacity: 0;
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease, bottom 0.4s ease;
    
    z-index: 2147483647 !important;
    pointer-events: auto;
    cursor: grab;
    overflow: hidden;
    user-select: none;
    border-left: 6px solid transparent; 
}

.toast:active { cursor: grabbing; }

.toast.show {
    transform: translateX(0);
    opacity: 1;
}

.toast-icon {
    display: grid;
    place-items: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    flex-shrink: 0;
    font-size: 24px;
}

.toast-content { flex-grow: 1; }
.toast-title { font-weight: 700; font-size: 0.95rem; margin: 0; line-height: 1.2; }
.toast-message { font-size: 0.85rem; opacity: 0.8; margin: 4px 0 0 0; line-height: 1.4; }

/* Progress Bar */
.toast-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    width: 100%;
    background-color: currentColor;
    opacity: 0.3;
    transform-origin: left;
    animation: progress linear forwards;
}

@keyframes progress {
    from { transform: scaleX(1); }
    to { transform: scaleX(0); }
}

/* Toast Theming */
/* Success */
.toast-success { border-color: #2e7d32; }
.toast-success .toast-icon { background: #e8f5e9; color: #2e7d32; }
.toast-success .toast-title { color: #1b5e20; }
.toast-success .toast-progress { background-color: #2e7d32; }

/* Error */
.toast-error { border-color: #c62828; }
.toast-error .toast-icon { background: #ffebee; color: #c62828; }
.toast-error .toast-title { color: #b71c1c; }
.toast-error .toast-progress { background-color: #c62828; }

/* Info */
.toast-info { border-color: #1565c0; }
.toast-info .toast-icon { background: #e3f2fd; color: #1565c0; }
.toast-info .toast-title { color: #0d47a1; }
.toast-info .toast-progress { background-color: #1565c0; }

/* Warning */
.toast-warning { border-color: #ef6c00; }
.toast-warning .toast-icon { background: #fff3e0; color: #ef6c00; }
.toast-warning .toast-title { color: #e65100; }
.toast-warning .toast-progress { background-color: #ef6c00; }

/* Custom Scrollbar - Global */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--md-sys-color-surface-container-low); 
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--md-sys-color-outline-variant); 
    border-radius: 4px;
    border: 2px solid var(--md-sys-color-surface-container-low); /* Creates padding effect */
}

::-webkit-scrollbar-thumb:hover {
    background: var(--md-sys-color-primary); 
}
